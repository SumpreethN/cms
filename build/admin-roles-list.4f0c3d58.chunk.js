"use strict";(self.webpackChunkcmssample=self.webpackChunkcmssample||[]).push([[3455],{51754:(w,P,t)=>{t.d(P,{F:()=>x});var e=t(27279),n=t(57537),O=t(61020),A=t(40464);const x=(F={},b={})=>{const{id:R="",...Z}=F,{get:K}=(0,n.useFetchClient)(),{locale:V}=(0,O.Z)(),B=(0,n.useCollator)(V,{sensitivity:"base"}),{data:E,error:r,isError:g,isLoading:$,refetch:H}=(0,A.useQuery)(["roles",R,Z],async()=>{const{data:f}=await K(`/admin/roles/${R??""}`,{params:Z});return f},b);return{roles:e.useMemo(()=>{let f=[];return R&&E?f=[E.data]:Array.isArray(E?.data)&&(f=E.data),[...f].sort((Q,I)=>B.compare(Q.name,I.name))},[E,R,B]),error:r,isError:g,isLoading:$,refetch:H}}},7513:(w,P,t)=>{t.r(P),t.d(P,{default:()=>ue});var e=t(27279),n=t(57537),O=t(49402),A=t(36364),x=t(9941),F=t(27875),b=t(48102),R=t(37472),Z=t(74758),K=t(70774),V=t(38566),B=t(38101),E=t(93153),r=t(50086),g=t(21395),$=t(10989),H=t(86967),Y=t(78031),f=t(26784),Q=t(78665),I=t(36938),j=t(61020),q=t(51447),_=t(51754);const ee=()=>"todo empty role";var te=t(10701),le=t(93415),ne=t(4987),ae=t(70627),h=t.n(ae);const z=({id:a,name:i,description:s,usersCount:T,icons:o,rowIndex:y,canUpdate:c})=>{const{formatMessage:p}=(0,j.Z)(),[,v]=o,d=p({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {#  user} one {#  user} other {# users}}"},{number:T});return e.createElement(E.Tr,{"aria-rowindex":y,key:a,...c?(0,n.onRowClick)({fn:v.onClick}):{}},e.createElement(r.Td,{maxWidth:(0,n.pxToRem)(130)},e.createElement(g.Z,{ellipsis:!0,textColor:"neutral800"},i)),e.createElement(r.Td,{maxWidth:(0,n.pxToRem)(250)},e.createElement(g.Z,{ellipsis:!0,textColor:"neutral800"},s)),e.createElement(r.Td,null,e.createElement(g.Z,{textColor:"neutral800"},d)),e.createElement(r.Td,null,e.createElement(te.k,{justifyContent:"flex-end",...n.stopPropagation},o.map((u,D)=>u?e.createElement(le.x,{key:u.label,paddingLeft:D===0?0:1},e.createElement(ne.h,{onClick:u.onClick,label:u.label,noBorder:!0,icon:u.icon})):null))))};z.propTypes={id:h().number.isRequired,name:h().string.isRequired,description:h().string.isRequired,usersCount:h().number.isRequired,icons:h().array.isRequired,rowIndex:h().number.isRequired,canUpdate:h().bool},z.defaultProps={canUpdate:!1};const se=z;var oe=t(61815);const re={roleToDelete:null,showModalConfirmButtonLoading:!1,shouldRefetchData:!1},ie=(a,i)=>(0,oe.ZP)(a,s=>{switch(i.type){case"ON_REMOVE_ROLES":{s.showModalConfirmButtonLoading=!0;break}case"ON_REMOVE_ROLES_SUCCEEDED":{s.shouldRefetchData=!0,s.roleToDelete=null;break}case"RESET_DATA_TO_DELETE":{s.shouldRefetchData=!1,s.roleToDelete=null,s.showModalConfirmButtonLoading=!1;break}case"SET_ROLE_TO_DELETE":{s.roleToDelete=i.id;break}default:return s}}),ce=({canCreate:a,canDelete:i,canUpdate:s,refetchRoles:T})=>{const{formatMessage:o}=(0,j.Z)(),{formatAPIError:y}=(0,n.useAPIErrorHandler)(),c=(0,n.useNotification)(),[p,v]=(0,e.useState)(!1),{push:d}=(0,q.k6)(),[{selectedRoles:u,showModalConfirmButtonLoading:D,roleToDelete:G},M]=(0,e.useReducer)(ie,re),{post:J}=(0,n.getFetchClient)(),X=async()=>{try{M({type:"ON_REMOVE_ROLES"}),await J("/admin/roles/batch-delete",{ids:[G]}),await T(),M({type:"RESET_DATA_TO_DELETE"})}catch(l){c({type:"warning",message:y(l)})}L()},S=(0,e.useCallback)(l=>{d(`/settings/roles/duplicate/${l}`)},[d]),W=()=>d("/settings/roles/new"),N=(0,e.useCallback)(l=>{M({type:"SET_ROLE_TO_DELETE",id:l}),L()},[]),L=()=>v(l=>!l),m=(0,e.useCallback)(l=>{d(`/settings/roles/${l}`)},[d]),U=(0,e.useCallback)((l,C)=>{l.preventDefault(),l.stopPropagation(),C.usersCount?c({type:"info",message:{id:"Roles.ListPage.notification.delete-not-allowed"}}):N(C.id)},[c,N]),k=(0,e.useCallback)((l,C)=>{l.preventDefault(),l.stopPropagation(),S(C.id)},[S]),me=(0,e.useCallback)(l=>[...a?[{onClick:C=>k(C,l),label:o({id:"app.utils.duplicate",defaultMessage:"Duplicate"}),icon:e.createElement(Y.Z,null)}]:[],...s?[{onClick:()=>m(l.id),label:o({id:"app.utils.edit",defaultMessage:"Edit"}),icon:e.createElement(f.Z,null)}]:[],...i?[{onClick:C=>U(C,l),label:o({id:"global.delete",defaultMessage:"Delete"}),icon:e.createElement(Q.Z,null)}]:[]],[o,U,k,m,a,s,i]);return{handleNewRoleClick:W,getIcons:me,selectedRoles:u,isWarningDeleteAllOpened:p,showModalConfirmButtonLoading:D,handleToggleModal:L,handleDeleteData:X}},de=()=>{const{formatMessage:a}=(0,j.Z)();(0,n.useFocusWhenNavigate)();const i=(0,O.v9)(A._),[{query:s}]=(0,n.useQueryParams)(),{isLoading:T,allowedActions:{canCreate:o,canDelete:y,canRead:c,canUpdate:p}}=(0,n.useRBAC)(i.settings.roles),{roles:v,isLoading:d,refetch:u}=(0,_.F)({filters:s?._q?{name:{$containsi:s._q}}:void 0},{cacheTime:0,enabled:!T&&c}),{handleNewRoleClick:D,getIcons:G,isWarningDeleteAllOpened:M,showModalConfirmButtonLoading:J,handleToggleModal:X,handleDeleteData:S}=ce({refetchRoles:u,canCreate:o,canDelete:y,canUpdate:p}),W=v.length+1,N=6;if(T)return e.createElement(x.o,null,e.createElement(n.LoadingIndicatorPage,null));const L=a({id:"global.roles",defaultMessage:"roles"});return e.createElement(x.o,null,e.createElement(n.SettingsPageTitle,{name:"Roles"}),e.createElement(F.T,{primaryAction:o?e.createElement(b.z,{onClick:D,startIcon:e.createElement(I.Z,null),size:"S"},a({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})):null,title:L,subtitle:a({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),as:"h2"}),c&&e.createElement(R.Z,{startActions:e.createElement(n.SearchURLQuery,{label:a({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:L})})}),c&&e.createElement(Z.D,null,e.createElement(K.i,{colCount:N,rowCount:W,footer:o?e.createElement(V.c,{onClick:D,icon:e.createElement(I.Z,null)},a({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})):null},e.createElement(B.h,null,e.createElement(E.Tr,{"aria-rowindex":1},e.createElement(r.Th,null,e.createElement(g.Z,{variant:"sigma",textColor:"neutral600"},a({id:"global.name",defaultMessage:"Name"}))),e.createElement(r.Th,null,e.createElement(g.Z,{variant:"sigma",textColor:"neutral600"},a({id:"global.description",defaultMessage:"Description"}))),e.createElement(r.Th,null,e.createElement(g.Z,{variant:"sigma",textColor:"neutral600"},a({id:"global.users",defaultMessage:"Users"}))),e.createElement(r.Th,null,e.createElement($.T,null,a({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(H.p,null,v?.map((m,U)=>e.createElement(se,{key:m.id,id:m.id,name:m.name,description:m.description,usersCount:m.usersCount,icons:G(m),rowIndex:U+2,canUpdate:p})))),!W&&!d&&e.createElement(ee,null)),e.createElement(n.ConfirmDialog,{isOpen:M,onConfirm:S,isConfirmButtonLoading:J,onToggleDialog:X}))},ue=()=>{const a=(0,O.v9)(A._);return e.createElement(n.CheckPagePermissions,{permissions:a.settings.roles.main},e.createElement(de,null))}}}]);
