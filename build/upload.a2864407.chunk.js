"use strict";(self.webpackChunkcmssample=self.webpackChunkcmssample||[]).push([[3650],{60648:(bt,_,t)=>{t.r(_),t.d(_,{default:()=>Lt});var e=t(27279),ee=t(9941),c=t(57537),Le=t(364),L=t(61020),Z=t(51447),Be=t(4396),R=t(18206),d=t(63955),P=t(93415),x=t(21395),Ae=t(27997),Te=t(37472),Ze=t(73411),$=t(4987),De=t(74758),te=t(74577),D=t(10701),Oe=t(10989),Re=t(84366),Pe=t(35318),xe=t(86485),Ie=t(66351),ze=t(26784),ae=t(29206),Ue=t(47533),G=t(72450),Qe=t(70572),be=t(21050),Ve=t(4114),I=t(28742),$e=t(52805),Ge=t(70627),m=t.n(Ge);const W=({pagination:n})=>e.createElement(P.x,{paddingTop:6},e.createElement(D.k,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(c.PageSizeURLQuery,null),e.createElement(c.PaginationURLQuery,{pagination:n})));W.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},W.propTypes={pagination:m().shape({page:m().number,pageCount:m().number,pageSize:m().number,total:m().number})};var We=t(45687),He=t(93184),Ne=t(19839),E=t(11727),je=t(54314),Ke=t(40426),Je=t(41801),Xe=t(60269),Ye=t(93593),T=t(48102),ke=t(78665),we=t(29731);const ne=({selected:n,onSuccess:l})=>{const{formatMessage:o}=(0,L.Z)(),[r,i]=(0,e.useState)(!1),{isLoading:u,remove:g}=(0,we.K)(),v=async()=>{await g(n),l()};return e.createElement(e.Fragment,null,e.createElement(T.z,{variant:"danger-light",size:"S",startIcon:e.createElement(ke.Z,null),onClick:()=>i(!0)},o({id:"global.delete",defaultMessage:"Delete"})),e.createElement(c.ConfirmDialog,{isConfirmButtonLoading:u,isOpen:r,onToggleDialog:()=>i(!1),onConfirm:v}))};ne.propTypes={selected:m().arrayOf(E.pw,E.nx).isRequired,onSuccess:m().func.isRequired};var qe=t(61287),se=t(5938),le=t(15244),_e=t(77970),et=t(6918),tt=t(23298),at=t(2878),nt=t(35250),st=t(71563),lt=t(10124),ot=t.n(lt),oe=t(40464);const rt=()=>{const n=(0,c.useNotification)(),l=(0,oe.useQueryClient)(),{post:o}=(0,c.useFetchClient)(),r=({destinationFolderId:g,filesAndFolders:v})=>{const f=v.reduce((p,M)=>{const{id:s,type:B}=M,h=B==="asset"?"fileIds":"folderIds";return p[h]||(p[h]=[]),p[h].push(s),p},{});return o("/upload/actions/bulk-move",{...f,destinationFolderId:g})},i=(0,oe.useMutation)(r,{onSuccess(g){const{data:{data:v}}=g;v?.files?.length>0&&(l.refetchQueries([R.Z,"assets"],{active:!0}),l.refetchQueries([R.Z,"asset-count"],{active:!0})),l.refetchQueries([R.Z,"folders"],{active:!0}),n({type:"success",message:{id:(0,d.OB)("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."}})}});return{...i,move:(g,v)=>i.mutateAsync({destinationFolderId:g,filesAndFolders:v})}};var it=t(81138),dt=t(71381);const H=({onClose:n,selected:l,currentFolder:o})=>{const{formatMessage:r}=(0,L.Z)(),{data:i,isLoading:u}=(0,it.v)(),{move:g}=rt();if(!i)return null;const v=async(M,{setErrors:s})=>{try{await g(M.destination.value,l),n()}catch(B){const z=(0,c.normalizeAPIError)(B).errors.reduce((U,F)=>(U[F.values?.path?.length||"destination"]=F.defaultMessage,U),{});ot()(z)||s(z)}},f=()=>{n()};if(u)return e.createElement(se.P,{onClose:f,labelledBy:"title"},e.createElement(le.f,null,e.createElement(D.k,{justifyContent:"center",paddingTop:4,paddingBottom:4},e.createElement(_e.a,null,r({id:(0,d.OB)("content.isLoading"),defaultMessage:"Content is loading."})))));const p={destination:{value:o?.id||"",label:o?.name||i[0].label}};return e.createElement(se.P,{onClose:f,labelledBy:"title"},e.createElement(st.Formik,{validateOnChange:!1,onSubmit:v,initialValues:p},({values:M,errors:s,setFieldValue:B})=>e.createElement(c.Form,{noValidate:!0},e.createElement(et.x,null,e.createElement(x.Z,{fontWeight:"bold",textColor:"neutral800",as:"h2",id:"title"},r({id:(0,d.OB)("modal.folder.move.title"),defaultMessage:"Move elements to"}))),e.createElement(le.f,null,e.createElement(tt.r,{gap:4},e.createElement(te.P,{xs:12,col:12},e.createElement(D.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(at.Q,{htmlFor:"folder-destination"},r({id:(0,d.OB)("form.input.label.folder-location"),defaultMessage:"Location"})),e.createElement(dt.Z,{options:i,onChange:h=>{B("destination",h)},defaultValue:M.destination,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:s?.destination,ariaErrorMessage:"destination-error"}),s.destination&&e.createElement(x.Z,{variant:"pi",as:"p",id:"folder-destination-error",textColor:"danger600"},s.destination))))),e.createElement(nt.m,{startActions:e.createElement(T.z,{onClick:f,variant:"tertiary",name:"cancel"},r({id:"cancel",defaultMessage:"Cancel"})),endActions:e.createElement(T.z,{type:"submit",loading:u},r({id:"modal.folder.move.submit",defaultMessage:"Move"}))}))))};H.defaultProps={currentFolder:void 0},H.propTypes={onClose:m().func.isRequired,currentFolder:E.nx,selected:m().arrayOf(E.nx,E.pw).isRequired};const N=({selected:n,onSuccess:l,currentFolder:o})=>{const{formatMessage:r}=(0,L.Z)(),[i,u]=(0,e.useState)(!1),g=()=>{u(!1),l()};return e.createElement(e.Fragment,null,e.createElement(T.z,{variant:"secondary",size:"S",startIcon:e.createElement(qe.Z,null),onClick:()=>u(!0)},r({id:"global.move",defaultMessage:"Move"})),i&&e.createElement(H,{currentFolder:o,onClose:g,selected:n}))};N.defaultProps={currentFolder:void 0},N.propTypes={onSuccess:m().func.isRequired,currentFolder:E.nx,selected:m().arrayOf(E.pw,E.nx).isRequired};const j=({selected:n,onSuccess:l,currentFolder:o})=>{const{formatMessage:r}=(0,L.Z)();return e.createElement(D.k,{gap:2,paddingBottom:5},e.createElement(x.Z,{variant:"epsilon",textColor:"neutral600"},r({id:(0,Ye.Z)("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:n.filter(({type:i})=>i==="folder").length,numberAssets:n.filter(({type:i})=>i==="asset").length})),e.createElement(ne,{selected:n,onSuccess:l}),e.createElement(N,{currentFolder:o,selected:n,onSuccess:l}))};j.defaultProps={currentFolder:void 0},j.propTypes={onSuccess:m().func.isRequired,currentFolder:E.nx,selected:m().arrayOf(E.pw,E.nx).isRequired};var ct=t(6162),K=t(36938),ut=t(54053);const mt=({isFiltering:n,canCreate:l,canRead:o})=>n?{id:"list.assets-empty.title-withSearch",defaultMessage:"There are no elements with the applied filters"}:o?l?{id:"list.assets.empty-upload",defaultMessage:"Upload your first assets..."}:{id:"list.assets.empty",defaultMessage:"Media Library is empty"}:{id:"header.actions.no-permissions",defaultMessage:"No permissions to view"},re=({canCreate:n,isFiltering:l,canRead:o,onActionClick:r})=>{const{formatMessage:i}=(0,L.Z)(),u=mt({isFiltering:l,canCreate:n,canRead:o});return e.createElement(ut.i,{icon:o?null:ct.Z,action:n&&!l&&e.createElement(T.z,{variant:"secondary",startIcon:e.createElement(K.Z,null),onClick:r},i({id:(0,d.OB)("header.actions.add-assets"),defaultMessage:"Add new assets"})),content:i({...u,id:(0,d.OB)(u.id)})})};re.propTypes={canCreate:m().bool.isRequired,canRead:m().bool.isRequired,isFiltering:m().bool.isRequired,onActionClick:m().func.isRequired};var gt=t(57121),ft=t(99398),Et=t(32269),ie=t(62082);const vt=()=>{const n=(0,e.useRef)(null),[l,o]=(0,e.useState)(!1),{formatMessage:r}=(0,L.Z)(),{trackUsage:i}=(0,c.useTracking)(),[{query:u},g]=(0,c.useQueryParams)(),v=u?.filters?.$and||[],f=()=>o(s=>!s),p=s=>{g({filters:{$and:s},page:1})},M=s=>{i("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(s[s.length-1])[0]}),g({filters:{$and:s},page:1})};return e.createElement(e.Fragment,null,e.createElement(T.z,{variant:"tertiary",ref:n,startIcon:e.createElement(gt.Z,null),onClick:f,size:"S"},r({id:"app.utils.filters",defaultMessage:"Filters"})),l&&e.createElement(Et.Z,{displayedFilters:ie.Z,filters:v,onSubmit:M,onToggle:f,source:n}),e.createElement(ft.Z,{appliedFilters:v,filtersSchema:ie.Z,onRemoveFilter:p}))};var pt=t(27875),ht=t(68412),yt=t(76827),Ct=t(94092);const J=({breadcrumbs:n,canCreate:l,folder:o,onToggleEditFolderDialog:r,onToggleUploadAssetDialog:i})=>{const{formatMessage:u}=(0,L.Z)(),{pathname:g}=(0,Z.TH)(),[{query:v}]=(0,c.useQueryParams)(),f={...v,folder:o?.parent?.id??void 0,folderPath:o?.parent?.path??void 0};return e.createElement(pt.T,{title:u({id:(0,d.OB)("plugin.name"),defaultMessage:"Media Library"}),subtitle:n&&o&&e.createElement(Ct.O,{as:"nav",label:u({id:(0,d.OB)("header.breadcrumbs.nav.label"),defaultMessage:"Folders navigation"}),breadcrumbs:n,currentFolderId:o?.id}),navigationAction:o&&e.createElement(ht.r,{startIcon:e.createElement(yt.Z,null),to:`${g}?${(0,ae.stringify)(f,{encode:!1})}`},u({id:(0,d.OB)("header.actions.folder-level-up"),defaultMessage:"Back"})),primaryAction:l&&e.createElement(D.k,{gap:2},e.createElement(T.z,{startIcon:e.createElement(K.Z,null),variant:"secondary",onClick:r},u({id:(0,d.OB)("header.actions.add-folder"),defaultMessage:"Add new folder"})),e.createElement(T.z,{startIcon:e.createElement(K.Z,null),onClick:i},u({id:(0,d.OB)("header.actions.add-assets"),defaultMessage:"Add new assets"})))})};J.defaultProps={breadcrumbs:!1,folder:null},J.propTypes={breadcrumbs:m().oneOfType([E.Fv,m().bool]),canCreate:m().bool.isRequired,folder:E.nx,onToggleEditFolderDialog:m().func.isRequired,onToggleUploadAssetDialog:m().func.isRequired};const Mt=(0,G.default)(P.x)`
  height: ${32/16}rem;
  display: flex;
  align-items: center;
`,de=(0,G.default)(x.Z)`
  max-width: 100%;
`,ce=(0,G.default)(P.x)`
  svg {
    path {
      fill: ${({theme:n})=>n.colors.neutral500};
    }
  }
`,Ft=()=>{const{push:n}=(0,Z.k6)(),{canRead:l,canCreate:o,canUpdate:r,canCopyLink:i,canDownload:u,isLoading:g}=(0,Xe.y)(),v=(0,e.useRef)(),{formatMessage:f}=(0,L.Z)(),{pathname:p}=(0,Z.TH)(),{trackUsage:M}=(0,c.useTracking)(),[{query:s},B]=(0,c.useQueryParams)(),h=Boolean(s._q||s.filters),[z,U]=(0,c.usePersistentState)(E.uf.view,E.Uk.GRID),F=z===E.Uk.GRID,{data:S,isLoading:Bt,errors:At}=(0,je.L)({skipWhen:!l,query:s}),{data:Tt,isLoading:Zt,errors:Dt}=(0,Je.j)({enabled:l&&S?.pagination?.page===1&&!(0,d.rV)(s),query:s}),{data:X,isLoading:ue,error:Ot}=(0,Ke.W)(s?.folder,{enabled:l&&!!s?.folder});Ot?.response?.status===404&&n(p);const Q=Tt?.map(a=>({...a,type:"folder",folderURL:(0,d.Km)(p,s,a.id),isSelectable:r}))??[],y=Q?.length||0,b=S?.results?.map(a=>({...a,type:"asset",isSelectable:r}))||[],C=b?.length??0,Rt=S?.pagination?.total,me=ue||Zt||g||Bt,[Pt,xt]=(0,e.useState)(!1),[It,ge]=(0,e.useState)(!1),[fe,Y]=(0,e.useState)(void 0),[k,Ee]=(0,e.useState)(void 0),[A,{selectOne:V,selectAll:ve}]=(0,c.useSelectionState)(["type","id"],[]),pe=A?.length>0&&A?.length!==C+y,w=()=>xt(a=>!a),he=({created:a=!1}={})=>{a&&s?.page!=="1"&&B({...s,page:1}),ge(O=>!O)},ye=(a,O)=>{a.target.checked&&M("didSelectAllMediaLibraryElements"),ve(O)},Ce=a=>{M("didSortMediaLibraryElements",{location:"upload",sort:a}),B({sort:a})},Me=a=>{Ee(a),ge(!0)},zt=a=>{Ee(null),he(a),v.current&&v.current.focus()},Fe=a=>{a===C&&S.pagination.page===S.pagination.pageCount&&S.pagination.page>1&&B({...s,page:S.pagination.page-1})},Ut=()=>{ve(),Fe(A.length)};return(0,c.useFocusWhenNavigate)(),e.createElement(Ae.A,null,e.createElement(ee.o,{"aria-busy":me},e.createElement(J,{breadcrumbs:!ue&&(0,d.M4)(X,{pathname:p,query:s}),canCreate:o,onToggleEditFolderDialog:he,onToggleUploadAssetDialog:w,folder:X}),e.createElement(Te.Z,{startActions:e.createElement(e.Fragment,null,r&&F&&(C>0||y>0)&&e.createElement(Mt,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200"},e.createElement(Ze.C,{"aria-label":f({id:(0,d.OB)("bulk.select.label"),defaultMessage:"Select all folders & assets"}),indeterminate:pe,value:(C>0||y>0)&&A.length===C+y,onChange:a=>ye(a,[...b,...Q])})),l&&F&&e.createElement(We.Z,{value:s?.sort,onChangeSort:Ce}),l&&e.createElement(vt,null)),endActions:e.createElement(e.Fragment,null,e.createElement(c.CheckPermissions,{permissions:E._I.configureView},e.createElement(ce,{paddingTop:1,paddingBottom:1},e.createElement($.h,{forwardedAs:Ue.Link,to:{pathname:`${p}/configuration`,search:(0,ae.stringify)(s,{encode:!1})},icon:e.createElement(Pe.Z,null),label:f({id:"app.links.configure-view",defaultMessage:"Configure the view"})}))),e.createElement(ce,{paddingTop:1,paddingBottom:1},e.createElement($.h,{icon:F?e.createElement(xe.Z,null):e.createElement(Ie.Z,null),label:f(F?{id:(0,d.OB)("view-switch.list"),defaultMessage:"List View"}:{id:(0,d.OB)("view-switch.grid"),defaultMessage:"Grid View"}),onClick:()=>U(F?E.Uk.LIST:E.Uk.GRID)})),e.createElement(c.SearchURLQuery,{label:f({id:(0,d.OB)("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}}))}),e.createElement(De.D,null,A.length>0&&e.createElement(j,{currentFolder:X,selected:A,onSuccess:Ut}),me&&e.createElement(c.LoadingIndicatorPage,null),(At||Dt)&&e.createElement(c.AnErrorOccurred,null),y===0&&C===0&&e.createElement(re,{canCreate:o,canRead:l,isFiltering:h,onActionClick:w}),l&&!F&&(C>0||y>0)&&e.createElement(He.b,{assetCount:C,folderCount:y,indeterminate:pe,onChangeSort:Ce,onChangeFolder:(a,O)=>n((0,d.Km)(p,s,{folder:a,folderPath:O})),onEditAsset:Y,onEditFolder:Me,onSelectOne:V,onSelectAll:ye,rows:[...Q,...b],selected:A,shouldDisableBulkSelect:!r,sortQuery:s?.sort??""}),l&&F&&e.createElement(e.Fragment,null,y>0&&e.createElement($e.a,{title:(h&&C>0||!h)&&f({id:(0,d.OB)("list.folders.title"),defaultMessage:"Folders ({count})"},{count:y})||""},Q.map(a=>{const Qt=!!A.filter(({type:q})=>q==="folder").find(q=>q.id===a.id),Se=(0,d.Km)(p,s,{folder:a?.id,folderPath:a?.path});return e.createElement(te.P,{col:3,key:`folder-${a.id}`},e.createElement(I.Ac,{ref:k&&a.id===k.id?v:void 0,ariaLabel:a.name,id:`folder-${a.id}`,to:Se,startAction:V&&a.isSelectable?e.createElement(I.MM,{"data-testid":`folder-checkbox-${a.id}`,value:Qt,onChange:()=>V(a)}):null,cardActions:e.createElement($.h,{icon:e.createElement(ze.Z,null),"aria-label":f({id:(0,d.OB)("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>Me(a)})},e.createElement(I.Bu,null,e.createElement(I.u6,{to:Se},e.createElement(D.k,{as:"h2",direction:"column",alignItems:"start",maxWidth:"100%"},e.createElement(de,{fontWeight:"semiBold",ellipsis:!0},a.name,e.createElement(Oe.T,null,":")),e.createElement(de,{as:"span",textColor:"neutral600",variant:"pi",ellipsis:!0},f({id:(0,d.OB)("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:a.children.count,filesCount:a.files.count})))))))})),C>0&&y>0&&e.createElement(P.x,{paddingTop:6,paddingBottom:4},e.createElement(Re.i,null)),C>0&&e.createElement(Qe.r,{assets:b,onEditAsset:Y,onSelectAsset:V,selectedAssets:A.filter(({type:a})=>a==="asset"),title:(!h||h&&y>0)&&S?.pagination?.page===1&&f({id:(0,d.OB)("list.assets.title"),defaultMessage:"Assets ({count})"},{count:Rt})||""})),S?.pagination&&e.createElement(W,{pagination:S.pagination}))),Pt&&e.createElement(Ne.x,{onClose:w,trackedLocation:"upload",folderId:s?.folder}),It&&e.createElement(Ve.f,{onClose:zt,folder:k,parentFolderId:s?.folder,location:"upload"}),fe&&e.createElement(be.s,{onClose:a=>{a===null&&Fe(1),Y(void 0)},asset:fe,canUpdate:r,canCopyLink:i,canDownload:u,trackedLocation:"upload"}))},St=(0,e.lazy)(()=>t.e(9514).then(t.bind(t,47670))),Lt=()=>{const{config:{isLoading:n,isError:l,data:o}}=(0,Be.Z)(),[{rawQuery:r},i]=(0,c.useQueryParams)(),{formatMessage:u}=(0,L.Z)(),g=u({id:(0,d.OB)("plugin.name"),defaultMessage:"Media Library"});return(0,e.useEffect)(()=>{n||l||r||i({sort:o.sort,page:1,pageSize:o.pageSize})},[n,l,o,r,i]),(0,c.useFocusWhenNavigate)(),e.createElement(ee.o,{"aria-busy":n},e.createElement(Le.q,{title:g}),n&&e.createElement(c.LoadingIndicatorPage,null),r?e.createElement(e.Suspense,{fallback:e.createElement(c.LoadingIndicatorPage,null)},e.createElement(Z.rs,null,e.createElement(Z.AW,{exact:!0,path:`/plugins/${R.Z}`,component:Ft}),e.createElement(Z.AW,{exact:!0,path:`/plugins/${R.Z}/configuration`,render:()=>e.createElement(St,{config:o})}))):null)}}}]);
