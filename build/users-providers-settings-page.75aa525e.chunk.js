"use strict";(self.webpackChunkcmssample=self.webpackChunkcmssample||[]).push([[2282],{1431:(le,F,t)=>{t.r(F),t.d(F,{ProvidersPage:()=>te,default:()=>Ze});var e=t(27279),x=t(27997),V=t(9941),z=t(27875),I=t(74758),S=t(70774),T=t(38101),L=t(93153),c=t(50086),p=t(21395),C=t(10989),Z=t(86967),ie=t(4987),n=t(57537),oe=t(26784),de=t(51943),ue=t.n(de),A=t(61020),N=t(40464),ce=t(5938),me=t(6918),ve=t(15244),ge=t(10701),pe=t(23298),fe=t(74577),he=t(35250),G=t(48102),be=t(89486),Ee=t(82298),ye=t(71563),Pe=t(70627),a=t.n(Pe),Me=t(2548),Te=t(12881);const j=({description:i,disabled:y,intlLabel:h,error:v,name:m,onChange:P,placeholder:l,providerToEditName:b,type:f,value:u})=>{const{formatMessage:d}=(0,A.Z)(),E=m==="noName"?`${window.strapi.backendURL}/api/connect/${b}/callback`:u,M=d({id:h.id,defaultMessage:h.defaultMessage},{provider:b,...h.values}),g=i?d({id:i.id,defaultMessage:i.defaultMessage},{provider:b,...i.values}):"";if(f==="bool")return e.createElement(Me.s,{"aria-label":m,checked:u,disabled:y,hint:g,label:M,name:m,offLabel:d({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:d({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:R=>{P({target:{name:m,value:R.target.checked}})}});const k=l?d({id:l.id,defaultMessage:l.defaultMessage},{...l.values}):"",X=v?d({id:v,defaultMessage:v}):"";return e.createElement(Te.o,{"aria-label":m,disabled:y,error:X,label:M,name:m,onChange:P,placeholder:k,type:f,value:E})};j.defaultProps={description:null,disabled:!1,error:"",placeholder:null,value:""},j.propTypes={description:a().shape({id:a().string.isRequired,defaultMessage:a().string.isRequired,values:a().object}),disabled:a().bool,error:a().string,intlLabel:a().shape({id:a().string.isRequired,defaultMessage:a().string.isRequired,values:a().object}).isRequired,name:a().string.isRequired,onChange:a().func.isRequired,placeholder:a().shape({id:a().string.isRequired,defaultMessage:a().string.isRequired,values:a().object}),providerToEditName:a().string.isRequired,type:a().string.isRequired,value:a().oneOfType([a().bool,a().string])};const Le=j,D=({headerBreadcrumbs:i,initialData:y,isSubmiting:h,layout:v,isOpen:m,onSubmit:P,onToggle:l,providerToEditName:b})=>{const{formatMessage:f}=(0,A.Z)();return m?e.createElement(ce.P,{onClose:l,labelledBy:"title"},e.createElement(me.x,null,e.createElement(be.O,{label:i.join(", ")},i.map((u,d,E)=>e.createElement(Ee.$,{isCurrent:d===E.length-1,key:u},u)))),e.createElement(ye.Formik,{onSubmit:u=>P(u),initialValues:y,validationSchema:v.schema,validateOnChange:!1},({errors:u,handleChange:d,values:E})=>e.createElement(n.Form,null,e.createElement(ve.f,null,e.createElement(ge.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(pe.r,{gap:5},v.form.map(M=>M.map(g=>e.createElement(fe.P,{key:g.name,col:g.size,xs:12},e.createElement(Le,{...g,error:u[g.name],onChange:d,value:E[g.name],providerToEditName:b}))))))),e.createElement(he.m,{startActions:e.createElement(G.z,{variant:"tertiary",onClick:l,type:"button"},f({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:e.createElement(G.z,{type:"submit",loading:h},f({id:"global.save",defaultMessage:"Save"}))})))):null};D.defaultProps={initialData:null,providerToEditName:null},D.propTypes={headerBreadcrumbs:a().arrayOf(a().string).isRequired,initialData:a().object,layout:a().shape({form:a().arrayOf(a().array),schema:a().object}).isRequired,isOpen:a().bool.isRequired,isSubmiting:a().bool.isRequired,onSubmit:a().func.isRequired,onToggle:a().func.isRequired,providerToEditName:a().string};const Ce=D;var J=t(84419),o=t(99688),r=t(47853);const K={id:(0,o.OB)("PopUpForm.Providers.redirectURL.front-end.label"),defaultMessage:"The redirect URL to your front-end app"},Y={id:"http://www.client-app.com",defaultMessage:"http://www.client-app.com"},q={id:(0,o.OB)("PopUpForm.Providers.enabled.description"),defaultMessage:"If disabled, users won't be able to use this provider."},H={id:(0,o.OB)("PopUpForm.Providers.enabled.label"),defaultMessage:"Enable"},w={id:(0,o.OB)("PopUpForm.Providers.key.label"),defaultMessage:"Client ID"},_={id:(0,o.OB)("PopUpForm.Providers.redirectURL.label"),defaultMessage:"The redirect URL to add in your {provider} application configurations"},O={id:(0,o.OB)("PopUpForm.Providers.key.placeholder"),defaultMessage:"TEXT"},ee={id:(0,o.OB)("PopUpForm.Providers.secret.label"),defaultMessage:"Client Secret"},W={email:{form:[[{intlLabel:H,name:"enabled",type:"bool",description:q,size:6}]],schema:r.Ry().shape({enabled:r.Xg().required(n.translatedErrors.required)})},providers:{form:[[{intlLabel:H,name:"enabled",type:"bool",description:q,size:6,validations:{required:!0}}],[{intlLabel:w,name:"key",type:"text",placeholder:O,size:12,validations:{required:!0}}],[{intlLabel:ee,name:"secret",type:"text",placeholder:O,size:12,validations:{required:!0}}],[{intlLabel:K,placeholder:Y,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:_,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:r.Ry().shape({enabled:r.Xg().required(n.translatedErrors.required),key:r.Z_().when("enabled",{is:!0,then:r.Z_().required(n.translatedErrors.required),otherwise:r.Z_()}),secret:r.Z_().when("enabled",{is:!0,then:r.Z_().required(n.translatedErrors.required),otherwise:r.Z_()}),callback:r.Z_().when("enabled",{is:!0,then:r.Z_().required(n.translatedErrors.required),otherwise:r.Z_()})})},providersWithSubdomain:{form:[[{intlLabel:H,name:"enabled",type:"bool",description:q,size:6,validations:{required:!0}}],[{intlLabel:w,name:"key",type:"text",placeholder:O,size:12,validations:{required:!0}}],[{intlLabel:ee,name:"secret",type:"text",placeholder:O,size:12,validations:{required:!0}}],[{intlLabel:{id:(0,o.OB)({id:"PopUpForm.Providers.jwksurl.label"}),defaultMessage:"JWKS URL"},name:"jwksurl",type:"text",placeholder:O,size:12,validations:{required:!1}}],[{intlLabel:{id:(0,o.OB)("PopUpForm.Providers.subdomain.label"),defaultMessage:"Host URI (Subdomain)"},name:"subdomain",type:"text",placeholder:{id:(0,o.OB)("PopUpForm.Providers.subdomain.placeholder"),defaultMessage:"my.subdomain.com"},size:12,validations:{required:!0}}],[{intlLabel:K,placeholder:Y,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:_,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:r.Ry().shape({enabled:r.Xg().required(n.translatedErrors.required),key:r.Z_().when("enabled",{is:!0,then:r.Z_().required(n.translatedErrors.required),otherwise:r.Z_()}),secret:r.Z_().when("enabled",{is:!0,then:r.Z_().required(n.translatedErrors.required),otherwise:r.Z_()}),subdomain:r.Z_().when("enabled",{is:!0,then:r.Z_().required(n.translatedErrors.required),otherwise:r.Z_()}),callback:r.Z_().when("enabled",{is:!0,then:r.Z_().required(n.translatedErrors.required),otherwise:r.Z_()})})}},te=()=>{const{formatMessage:i,locale:y}=(0,A.Z)(),h=(0,N.useQueryClient)(),{trackUsage:v}=(0,n.useTracking)(),[m,P]=e.useState(!1),[l,b]=e.useState(null),f=(0,n.useNotification)(),{lockApp:u,unlockApp:d}=(0,n.useOverlayBlocker)(),{get:E,put:M}=(0,n.useFetchClient)(),{formatAPIError:g}=(0,n.useAPIErrorHandler)(),k=(0,n.useCollator)(y,{sensitivity:"base"});(0,n.useFocusWhenNavigate)();const{isLoading:X,allowedActions:{canUpdate:R}}=(0,n.useRBAC)({update:J._.updateProviders}),{isLoading:Oe,data:$}=(0,N.useQuery)(["users-permissions","get-providers"],async()=>{const{data:s}=await E("/users-permissions/providers");return s},{initialData:{}}),ae=(0,N.useMutation)(s=>M("/users-permissions/providers",s),{async onSuccess(){await h.invalidateQueries(["users-permissions","providers"]),f({type:"success",message:{id:(0,o.OB)("notification.success.submit")}}),v("didEditAuthenticationProvider"),Q(),d()},onError(s){f({type:"warning",message:g(s)}),d()},refetchActive:!1}),U=Object.entries($).reduce((s,[B,xe])=>{const{icon:ne,enabled:Se,subdomain:Ue}=xe;return s.push({name:B,icon:ne==="envelope"?["fas","envelope"]:["fab",ne],enabled:Se,subdomain:Ue}),s},[]).sort((s,B)=>k.compare(s.name,B.name)),Re=Oe||X,re=e.useMemo(()=>l?!!U.find(B=>B.name===l)?.subdomain:!1,[U,l]),Be=e.useMemo(()=>l==="email"?W.email:re?W.providersWithSubdomain:W.providers,[l,re]),Q=()=>{P(s=>!s)},se=s=>{R&&(b(s.name),Q())},Fe=async s=>{u(),v("willEditAuthenticationProvider"),ae.mutate({providers:{...$,[l]:s}})};return e.createElement(x.A,null,e.createElement(n.SettingsPageTitle,{name:i({id:(0,o.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),e.createElement(V.o,null,e.createElement(z.T,{title:i({id:(0,o.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),Re?e.createElement(n.LoadingIndicatorPage,null):e.createElement(I.D,null,e.createElement(S.i,{colCount:3,rowCount:U.length+1},e.createElement(T.h,null,e.createElement(L.Tr,null,e.createElement(c.Th,null,e.createElement(p.Z,{variant:"sigma",textColor:"neutral600"},i({id:"global.name",defaultMessage:"Name"}))),e.createElement(c.Th,null,e.createElement(p.Z,{variant:"sigma",textColor:"neutral600"},i({id:(0,o.OB)("Providers.status"),defaultMessage:"Status"}))),e.createElement(c.Th,null,e.createElement(p.Z,{variant:"sigma"},e.createElement(C.T,null,i({id:"global.settings",defaultMessage:"Settings"})))))),e.createElement(Z.p,null,U.map(s=>e.createElement(L.Tr,{key:s.name,...(0,n.onRowClick)({fn:()=>se(s),condition:R})},e.createElement(c.Td,{width:"45%"},e.createElement(p.Z,{fontWeight:"semiBold",textColor:"neutral800"},s.name)),e.createElement(c.Td,{width:"65%"},e.createElement(p.Z,{textColor:s.enabled?"success600":"danger600","data-testid":`enable-${s.name}`},s.enabled?i({id:"global.enabled",defaultMessage:"Enabled"}):i({id:"global.disabled",defaultMessage:"Disabled"}))),e.createElement(c.Td,{...n.stopPropagation},R&&e.createElement(ie.h,{onClick:()=>se(s),noBorder:!0,icon:e.createElement(oe.Z,null),label:"Edit"})))))))),e.createElement(Ce,{initialData:$[l],isOpen:m,isSubmiting:ae.isLoading,layout:Be,headerBreadcrumbs:[i({id:(0,o.OB)("PopUpForm.header.edit.providers"),defaultMessage:"Edit Provider"}),ue()(l)],onToggle:Q,onSubmit:Fe,providerToEditName:l}))},Ze=()=>e.createElement(n.CheckPagePermissions,{permissions:J._.readProviders},e.createElement(te,null))},99688:(le,F,t)=>{t.d(F,{YX:()=>z,OB:()=>I.Z});var e=t(10124),x=t.n(e);const z=S=>Object.keys(S).reduce((T,L)=>{const c=S[L].controllers,p=Object.keys(c).reduce((C,Z)=>(x()(c[Z])||(C[Z]=c[Z]),C),{});return x()(p)||(T[L]={controllers:p}),T},{});var I=t(58655)}}]);
