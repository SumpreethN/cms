"use strict";(self.webpackChunkcmssample=self.webpackChunkcmssample||[]).push([[4121],{38542:(Te,w,t)=>{t.r(w),t.d(w,{default:()=>oe});var e=t(27279),o=t(57537),k=t(49402),P=t(36364),z=t(51926),H=t(27997),O=t(9941),U=t(27875),G=t(37472),i=t(21395),Z=t(48102),Q=t(74758),Y=t(93415),K=t(70774),j=t(38566),J=t(38101),x=t(93153),l=t(50086),D=t(73411),X=t(10989),q=t(86967),A=t(10701),_=t(89053),B=t(4987),ee=t(6191),f=t(36938),W=t(78665),te=t(26784),ae=t(52448),ne=t(61020),v=t(40464),p=t(51447);const se=()=>{const[b,c]=(0,e.useState)(!1),[C,r]=(0,e.useState)([]),le=(0,k.v9)(P._),{formatMessage:n}=(0,ne.Z)(),{formatAPIError:u}=(0,o.useAPIErrorHandler)(),g=(0,o.useNotification)();(0,o.useFocusWhenNavigate)();const{push:ie}=(0,p.k6)(),{pathname:V}=(0,p.TH)(),{isLoading:re,allowedActions:{canCreate:T,canUpdate:I,canDelete:$}}=(0,o.useRBAC)(le.settings.webhooks),{get:de,post:ce,put:me}=(0,o.useFetchClient)(),{notifyStatus:N}=(0,z.G)(),ue="webhooks",{isLoading:ge,data:d,error:S,refetch:R}=(0,v.useQuery)(ue,async()=>{const{data:{data:a}}=await de("/admin/webhooks");return a});(0,e.useEffect)(()=>{if(S){g({type:"warning",message:u(S)});return}d&&N(n({id:"Settings.webhooks.list.loading.success",defaultMessage:"Webhooks have been loaded"}))},[d,S,g,n,N,u]);const F=(0,v.useMutation)(async()=>{await ce("/admin/webhooks/batch-delete",{ids:C})},{onError(a){g({type:"warning",message:u(a)}),c(!1)},onSuccess(){r([]),c(!1),R()}}),he=(0,v.useMutation)(async({isEnabled:a,id:s})=>{const{id:E,...L}=d.find(Ce=>Ce.id===s)??{},be={...L,isEnabled:a};await me(`/admin/webhooks/${s}`,be)},{onError(a){g({type:"warning",message:u(a)})},onSuccess(){R()}}),Ee=()=>F.mutate(),fe=a=>r(a?d.map(s=>s.id):[]),ve=(a,s)=>r(a?E=>[...E,s]:E=>E.filter(L=>L!==s)),M=a=>ie(`${V}/${a}`),y=re||ge,h=d?.length??0,m=C.length;return e.createElement(H.A,null,e.createElement(o.SettingsPageTitle,{name:"Webhooks"}),e.createElement(O.o,{"aria-busy":y},e.createElement(U.T,{title:n({id:"Settings.webhooks.title",defaultMessage:"Webhooks"}),subtitle:n({id:"Settings.webhooks.list.description",defaultMessage:"Get POST changes notifications"}),primaryAction:T&&!y&&e.createElement(o.LinkButton,{startIcon:e.createElement(f.Z,null),variant:"default",to:`${V}/create`,size:"S"},n({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))}),m>0&&$&&e.createElement(G.Z,{startActions:e.createElement(e.Fragment,null,e.createElement(i.Z,{variant:"epsilon",textColor:"neutral600"},n({id:"Settings.webhooks.to.delete",defaultMessage:"{webhooksToDeleteLength, plural, one {# webhook} other {# webhooks}} selected"},{webhooksToDeleteLength:m})),e.createElement(Z.z,{onClick:()=>c(!0),startIcon:e.createElement(W.Z,null),size:"L",variant:"danger-light"},n({id:"global.delete",defaultMessage:"Delete"})))}),e.createElement(Q.D,null,y?e.createElement(Y.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(o.LoadingIndicatorPage,null)):h>0?e.createElement(K.i,{colCount:5,rowCount:h+1,footer:e.createElement(j.c,{onClick:()=>T?M("create"):{},icon:e.createElement(f.Z,null)},n({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))},e.createElement(J.h,null,e.createElement(x.Tr,null,e.createElement(l.Th,null,e.createElement(D.C,{"aria-label":n({id:"global.select-all-entries",defaultMessage:"Select all entries"}),indeterminate:m>0&&m<h,value:m===h,onValueChange:fe})),e.createElement(l.Th,{width:"20%"},e.createElement(i.Z,{variant:"sigma",textColor:"neutral600"},n({id:"global.name",defaultMessage:"Name"}))),e.createElement(l.Th,{width:"60%"},e.createElement(i.Z,{variant:"sigma",textColor:"neutral600"},n({id:"Settings.webhooks.form.url",defaultMessage:"URL"}))),e.createElement(l.Th,{width:"20%"},e.createElement(i.Z,{variant:"sigma",textColor:"neutral600"},n({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"}))),e.createElement(l.Th,null,e.createElement(X.T,null,n({id:"Settings.webhooks.list.th.actions",defaultMessage:"Actions"}))))),e.createElement(q.p,null,d.map(a=>e.createElement(x.Tr,{key:a.id,...(0,o.onRowClick)({fn:()=>M(a.id),condition:I})},e.createElement(l.Td,{...o.stopPropagation},e.createElement(D.C,{"aria-label":`${n({id:"global.select",defaultMessage:"Select"})} ${a.name}`,value:C?.includes(a.id),onValueChange:s=>ve(s,a.id),name:"select"})),e.createElement(l.Td,null,e.createElement(i.Z,{fontWeight:"semiBold",textColor:"neutral800"},a.name)),e.createElement(l.Td,null,e.createElement(i.Z,{textColor:"neutral800"},a.url)),e.createElement(l.Td,null,e.createElement(A.k,null,e.createElement(_.r,{onLabel:n({id:"global.enabled",defaultMessage:"Enabled"}),offLabel:n({id:"global.disabled",defaultMessage:"Disabled"}),label:`${a.name} ${n({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})}`,selected:a.isEnabled,onChange:s=>{s.stopPropagation(),he.mutate({isEnabled:!a.isEnabled,id:a.id})},visibleLabels:!0}))),e.createElement(l.Td,null,e.createElement(A.k,{gap:1},I&&e.createElement(B.h,{label:n({id:"Settings.webhooks.events.update",defaultMessage:"Update"}),icon:e.createElement(te.Z,null),noBorder:!0}),$&&e.createElement(B.h,{onClick:s=>{s.stopPropagation(),r([a.id]),c(!0)},label:n({id:"Settings.webhooks.events.delete",defaultMessage:"Delete webhook"}),icon:e.createElement(W.Z,null),noBorder:!0}))))))):e.createElement(ee.x,{icon:e.createElement(ae.Z,{width:"160px"}),content:n({id:"Settings.webhooks.list.empty.description",defaultMessage:"No webhooks found"}),action:e.createElement(Z.z,{variant:"secondary",startIcon:e.createElement(f.Z,null),onClick:()=>T?M("create"):{}},n({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))}))),e.createElement(o.ConfirmDialog,{isOpen:b,onToggleDialog:()=>c(a=>!a),onConfirm:Ee,isConfirmButtonLoading:F.isLoading}))},oe=()=>{const b=(0,k.v9)(P._);return e.createElement(o.CheckPagePermissions,{permissions:b.settings.webhooks.main},e.createElement(se,null))}}}]);
