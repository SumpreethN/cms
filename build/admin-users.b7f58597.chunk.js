"use strict";(self.webpackChunkcmssample=self.webpackChunkcmssample||[]).push([[5199],{54920:(Q,u,e)=>{e.d(u,{R:()=>E});var t=e(27279),M=e(57537),i=e(40464);function E(y={},a={}){const{id:s="",...c}=y,{get:m}=(0,M.useFetchClient)(),{data:n,isError:C,isLoading:A,refetch:R}=(0,i.useQuery)(["users",s,c],async()=>{const{data:{data:v}}=await m(`/admin/users/${s}`,{params:c});return v},a);return{users:t.useMemo(()=>s&&n?[n]:Array.isArray(n?.results)?n.results:[],[n,s]),pagination:t.useMemo(()=>n?.pagination??null,[n?.pagination]),isLoading:A,isError:C,refetch:R}}},71359:(Q,u,e)=>{e.d(u,{Z:()=>n});var t=e(27279),M=e(93415),i=e(48102),E=e(57537),y=e(57121),a=e(70627),s=e.n(a),c=e(61020);const m=({displayedFilters:C})=>{const[A,R]=(0,t.useState)(!1),{formatMessage:P}=(0,c.Z)(),v=(0,t.useRef)(),B=()=>{R(T=>!T)};return t.createElement(t.Fragment,null,t.createElement(M.x,{paddingTop:1,paddingBottom:1},t.createElement(i.z,{variant:"tertiary",ref:v,startIcon:t.createElement(y.Z,null),onClick:B,size:"S"},P({id:"app.utils.filters",defaultMessage:"Filters"})),A&&t.createElement(E.FilterPopoverURLQuery,{displayedFilters:C,isVisible:A,onToggle:B,source:v})),t.createElement(E.FilterListURLQuery,{filtersSchema:C}))};m.propTypes={displayedFilters:s().arrayOf(s().shape({name:s().string.isRequired,metadatas:s().shape({label:s().string}),fieldSchema:s().shape({type:s().string})})).isRequired};const n=m},61611:(Q,u,e)=>{e.d(u,{W:()=>pe,Z:()=>Ze});var t=e(27279),M=e(9941),i=e(27875),E=e(37472),y=e(74758),a=e(57537),s=e(29206),c=e.n(s),m=e(61020),n=e(40464),C=e(49402),A=e(51447),R=e(54920),P=e(80902),v=e(36364),B=e(71359),T=e(48102),F=e(16543),se=e(70627),o=e.n(se);const _=({onClick:l})=>{const{formatMessage:g}=(0,m.Z)();return t.createElement(T.z,{onClick:l,startIcon:t.createElement(F.Z,null),size:"S"},g({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}))};_.propTypes={onClick:o().func.isRequired};var ne=e(86967),Z=e(93153),j=e(50086),le=e(73411),x=e(21395),b=e(10701),ee=e(4987),d=e(93415),fe=e(26784),Me=e(78665),re=e(96854);const oe=({canDelete:l,headers:g,entriesToDelete:L,onClickDelete:k,onSelectRow:$,withMainAction:z,withBulkActions:W,rows:U})=>{const{push:h,location:{pathname:H}}=(0,A.k6)(),{formatMessage:D}=(0,m.Z)();return t.createElement(ne.p,null,U.map(r=>{const N=L.findIndex(I=>I===r.id)!==-1;return t.createElement(Z.Tr,{key:r.id,...(0,a.onRowClick)({fn:()=>h(`${H}/${r.id}`),condition:W})},z&&t.createElement(j.Td,{...a.stopPropagation},t.createElement(le.C,{"aria-label":D({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,re.Pp)(r.firstname,r.lastname)}),checked:N,onChange:()=>{$({name:r.id,value:!N})}})),g.map(({key:I,cellFormatter:V,name:K,...X})=>t.createElement(j.Td,{key:I},typeof V=="function"?V(r,{key:I,name:K,formatMessage:D,...X}):t.createElement(x.Z,{textColor:"neutral800"},r[K]||"-"))),W&&t.createElement(j.Td,null,t.createElement(b.k,{justifyContent:"end"},t.createElement(ee.h,{onClick:()=>h(`${H}/${r.id}`),label:D({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,re.Pp)(r.firstname,r.lastname)}),noBorder:!0,icon:t.createElement(fe.Z,null)}),l&&t.createElement(d.x,{paddingLeft:1,...a.stopPropagation},t.createElement(ee.h,{onClick:()=>k(r.id),label:D({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,re.Pp)(r.firstname,r.lastname)}),noBorder:!0,icon:t.createElement(Me.Z,null)})))))}))};oe.defaultProps={canDelete:!1,entriesToDelete:[],onClickDelete(){},onSelectRow(){},rows:[],withBulkActions:!1,withMainAction:!1},oe.propTypes={canDelete:o().bool,entriesToDelete:o().array,headers:o().array.isRequired,onClickDelete:o().func,onSelectRow:o().func,rows:o().array,withBulkActions:o().bool,withMainAction:o().bool};const ye=oe;var Pe=e(5938),ve=e(6918),he=e(15244),de=e(23298),ie=e(74577),Ce=e(35250),Ae=e(89486),Te=e(82298),De=e(71563),Le=e(30164),Oe=e(85243),J=e(47853);const ue={firstname:"",lastname:"",email:"",roles:[]},Re=[],Ue=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],Ie=J.Ry().shape({firstname:J.Z_().trim().required(a.translatedErrors.required),lastname:J.Z_(),email:J.Z_().email(a.translatedErrors.email).required(a.translatedErrors.required),roles:J.IX().min(1,a.translatedErrors.required).required(a.translatedErrors.required)}),Se={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},Ee=({onSuccess:l,onToggle:g})=>{const[L,k]=(0,t.useState)("create"),[$,z]=(0,t.useState)(!1),[W,U]=(0,t.useState)(null),{formatMessage:h}=(0,m.Z)(),H=(0,a.useNotification)(),{lockApp:D,unlockApp:r}=(0,a.useOverlayBlocker)(),{post:N}=(0,a.useFetchClient)(),I=(0,P.c)(Re,async()=>(await e.e(9329).then(e.bind(e,99329))).ROLE_LAYOUT,{combine(f,S){return[...f,S]},defaultValue:[]}),V=(0,P.c)(ue,async()=>(await e.e(9329).then(e.bind(e,99329))).FORM_INITIAL_VALUES,{combine(f,S){return{...f,...S}},defaultValue:ue}),K=(0,P.c)(Le.A,async()=>(await e.e(566).then(e.bind(e,20566))).MagicLinkEE),X=(0,n.useMutation)(f=>N("/admin/users",f),{async onSuccess({data:f}){U(f.data.registrationToken),await l(),ae(),z(!1)},onError(f){throw z(!1),H({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),f},onSettled(){r()}}),w=h({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),te=async(f,{setErrors:S})=>{D(),z(!0);try{await X.mutateAsync(f)}catch(G){r(),G?.response?.data?.error.message==="Email already taken"&&S({email:G.response.data.error.message})}},ae=()=>{p?k(p):g()},{buttonSubmitLabel:q,isDisabled:Y,next:p}=Se[L],xe=L==="create"?t.createElement(T.z,{type:"submit",loading:$},h(q)):t.createElement(T.z,{type:"button",loading:$,onClick:g},h(q));return K?t.createElement(Pe.P,{onClose:g,labelledBy:"title"},t.createElement(ve.x,null,t.createElement(Ae.O,{label:w},t.createElement(Te.$,{isCurrent:!0},w))),t.createElement(De.Formik,{enableReinitialize:!0,initialValues:V,onSubmit:te,validationSchema:Ie,validateOnChange:!1},({errors:f,handleChange:S,values:G})=>t.createElement(a.Form,null,t.createElement(he.f,null,t.createElement(b.k,{direction:"column",alignItems:"stretch",gap:6},L!=="create"&&t.createElement(K,{registrationToken:W}),t.createElement(d.x,null,t.createElement(x.Z,{variant:"beta",as:"h2"},h({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})),t.createElement(d.x,{paddingTop:4},t.createElement(b.k,{direction:"column",alignItems:"stretch",gap:1},t.createElement(de.r,{gap:5},Ue.map(me=>me.map(O=>t.createElement(ie.P,{key:O.name,...O.size},t.createElement(a.GenericInput,{...O,disabled:Y,error:f[O.name],onChange:S,value:G[O.name]})))))))),t.createElement(d.x,null,t.createElement(x.Z,{variant:"beta",as:"h2"},h({id:"global.roles",defaultMessage:"User's role"})),t.createElement(d.x,{paddingTop:4},t.createElement(de.r,{gap:5},t.createElement(ie.P,{col:6,xs:12},t.createElement(Oe.Z,{disabled:Y,error:f.roles,onChange:S,value:G.roles})),I.map(me=>me.map(O=>t.createElement(ie.P,{key:O.name,...O.size},t.createElement(a.GenericInput,{...O,disabled:Y,onChange:S,value:G[O.name]}))))))))),t.createElement(Ce.m,{startActions:t.createElement(T.z,{variant:"tertiary",onClick:g,type:"button"},h({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:xe})))):null};Ee.propTypes={onToggle:o().func.isRequired,onSuccess:o().func.isRequired};const Be=Ee,ce=({pagination:l})=>t.createElement(d.x,{paddingTop:4},t.createElement(b.k,{alignItems:"flex-end",justifyContent:"space-between"},t.createElement(a.PageSizeURLQuery,null),t.createElement(a.PaginationURLQuery,{pagination:l})));ce.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},ce.propTypes={pagination:o().shape({page:o().number,pageCount:o().number,pageSize:o().number,total:o().number})};const We=ce,Ke=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],Fe=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:l},{formatMessage:g}){return t.createElement(x.Z,{textColor:"neutral800"},l.map(L=>g({id:`Settings.permissions.users.${L.code}`,defaultMessage:L.name})).join(`,
`))}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:l},{formatMessage:g}){return t.createElement(b.k,null,t.createElement(a.Status,{isActive:l,variant:l?"success":"danger"}),t.createElement(x.Z,{textColor:"neutral800"},g({id:l?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:l?"Active":"Inactive"})))}}],ge=["ee","license-limit-info"],pe=()=>{const{post:l}=(0,a.useFetchClient)(),{formatAPIError:g}=(0,a.useAPIErrorHandler)(),[L,k]=(0,t.useState)(!1),$=(0,C.v9)(v._),{allowedActions:{canCreate:z,canDelete:W,canRead:U}}=(0,a.useRBAC)($.settings.users),h=(0,n.useQueryClient)(),H=(0,a.useNotification)(),{formatMessage:D}=(0,m.Z)(),{search:r}=(0,A.TH)();(0,a.useFocusWhenNavigate)();const{users:N,pagination:I,isError:V,isLoading:K,refetch:X}=(0,R.R)(c().parse(r,{ignoreQueryPrefix:!0}),{cacheTime:0,enabled:U}),w=(0,P.c)(_,async()=>(await e.e(5833).then(e.bind(e,85833))).CreateActionEE),te=Fe.map(p=>({...p,metadatas:{...p.metadatas,label:D(p.metadatas.label)}})),ae=D({id:"global.users",defaultMessage:"Users"}),q=()=>{k(p=>!p)},Y=(0,n.useMutation)(async p=>{await l("/admin/users/batch-delete",{ids:p})},{async onSuccess(){await X(),await h.refetchQueries(ge)},onError(p){H({type:"warning",message:{id:"notification.error",message:g(p),defaultMessage:"An error occured"}})}});return w?t.createElement(M.o,{"aria-busy":K},t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(i.T,{primaryAction:z&&t.createElement(w,{onClick:q}),title:ae,subtitle:D({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),U&&t.createElement(E.Z,{startActions:t.createElement(t.Fragment,null,t.createElement(a.SearchURLQuery,{label:D({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:ae})}),t.createElement(B.Z,{displayedFilters:Ke}))}),t.createElement(y.D,{canRead:U},!U&&t.createElement(a.NoPermissions,null),V&&t.createElement("div",null,"TODO: An error occurred"),U&&t.createElement(t.Fragment,null,t.createElement(a.DynamicTable,{contentType:"Users",isLoading:K,onConfirmDeleteAll:Y.mutateAsync,onConfirmDelete:p=>Y.mutateAsync([p]),headers:te,rows:N,withBulkActions:!0,withMainAction:W},t.createElement(ye,{canDelete:W,headers:te,rows:N,withBulkActions:!0,withMainAction:W})),I&&t.createElement(We,{pagination:I}))),L&&t.createElement(Be,{onSuccess:async()=>{await X(),await h.refetchQueries(ge)},onToggle:q})):null},Ze=()=>{const l=(0,P.c)(pe,async()=>(await e.e(5481).then(e.bind(e,17403))).UserListPageEE);return l?t.createElement(l,null):null}},87901:(Q,u,e)=>{e.r(u),e.d(u,{default:()=>s});var t=e(27279),M=e(57537),i=e(49402),E=e(36364),y=e(61611);const s=()=>{const c=(0,i.v9)(E._);return t.createElement(M.CheckPagePermissions,{permissions:c.settings.users.main},t.createElement(y.Z,null))}},6324:(Q,u,e)=>{e.d(u,{Z:()=>m});var t=e(27279),M=e(4987),i=e(57537),E=e(78031),y=e(70627),a=e.n(y),s=e(61020);const c=({children:n,target:C})=>{const A=(0,i.useNotification)(),{formatMessage:R}=(0,s.Z)(),{copy:P}=(0,i.useClipboard)(),v=R({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),B=async()=>{await P(C)&&A({type:"info",message:{id:"notification.link-copied"}})};return t.createElement(i.ContentBox,{endAction:t.createElement(M.h,{label:v,noBorder:!0,icon:t.createElement(E.Z,null),onClick:B}),title:C,titleEllipsis:!0,subtitle:n,icon:t.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};c.propTypes={children:a().oneOfType([a().element,a().string]).isRequired,target:a().string.isRequired};const m=c},30164:(Q,u,e)=>{e.d(u,{A:()=>s});var t=e(27279),M=e(70627),i=e.n(M),E=e(61020),y=e(95651),a=e(6324);const s=({registrationToken:c})=>{const{formatMessage:m}=(0,E.Z)(),n=`${window.location.origin}${y.Z}auth/register?registrationToken=${c}`;return t.createElement(a.Z,{target:n},m({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};s.defaultProps={registrationToken:""},s.propTypes={registrationToken:i().string}},85243:(Q,u,e)=>{e.d(u,{Z:()=>B});var t=e(27279),M=e(5627),i=e(78955),E=e(57537),y=e(34547),a=e(70627),s=e.n(a),c=e(61020),m=e(40464),n=e(72450);const C=(0,n.keyframes)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,A=n.default.div`
  animation: ${C} 2s infinite linear;
`,R=()=>t.createElement(A,null,t.createElement(y.Z,null)),P=async()=>{const{get:T}=(0,E.getFetchClient)(),{data:F}=await T("/admin/roles");return F.data},v=({disabled:T,error:F,onChange:se,value:o})=>{const{status:_,data:ne}=(0,m.useQuery)(["roles"],P,{staleTime:5e4}),{formatMessage:Z}=(0,c.Z)(),j=F?Z({id:F,defaultMessage:F}):"",le=Z({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),x=Z({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),b=Z({id:"app.components.Select.placeholder",defaultMessage:"Select"}),ee=_==="loading"?t.createElement(R,null):void 0;return t.createElement(M.P,{id:"roles",disabled:T,error:j,hint:x,label:le,name:"roles",onChange:d=>{se({target:{name:"roles",value:d}})},placeholder:b,multi:!0,startIcon:ee,value:o.map(d=>d.toString()),withTags:!0,required:!0},(ne||[]).map(d=>t.createElement(i.W,{key:d.id,value:d.id.toString()},Z({id:`global.${d.code}`,defaultMessage:d.name}))))};v.defaultProps={disabled:!1,error:void 0},v.propTypes={disabled:s().bool,error:s().string,onChange:s().func.isRequired,value:s().array.isRequired};const B=v}}]);
