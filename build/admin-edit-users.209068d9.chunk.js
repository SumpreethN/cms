"use strict";(self.webpackChunkcmssample=self.webpackChunkcmssample||[]).push([[4263],{54920:(W,u,e)=>{e.d(u,{R:()=>c});var t=e(27279),a=e(57537),l=e(40464);function c(f={},i={}){const{id:n="",...m}=f,{get:g}=(0,a.useFetchClient)(),{data:s,isError:o,isLoading:M,refetch:y}=(0,l.useQuery)(["users",n,m],async()=>{const{data:{data:v}}=await g(`/admin/users/${n}`,{params:m});return v},i);return{users:t.useMemo(()=>n&&s?[s]:Array.isArray(s?.results)?s.results:[],[s,n]),pagination:t.useMemo(()=>s?.pagination??null,[s?.pagination]),isLoading:M,isError:o,refetch:y}}},93552:(W,u,e)=>{e.r(u),e.d(u,{default:()=>re});var t=e(27279),a=e(57537),l=e(49402),c=e(51447),f=e(36364),i=e(9941),n=e(27875),m=e(48102),g=e(74758),s=e(93415),o=e(10701),M=e(21395),y=e(23298),O=e(74577),v=e(59082),R=e(76827),B=e(71563),C=e(98934),z=e.n(C),N=e(74919),$=e.n(N),X=e(47184),L=e.n(X),Y=e(70627),G=e.n(Y),H=e(61020),j=e(54920),Q=e(80902),E=e(96854),ee=e(30164),te=e(85243),ae=e(39394);const se=async(A,d)=>{const{put:T}=(0,a.getFetchClient)(),{data:I}=await T(`/admin/users/${A}`,d);return I.data},ne=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]],b=["email","firstname","lastname","username","isActive","roles"],k=({canUpdate:A})=>{const{formatMessage:d}=(0,H.Z)(),{params:{id:T}}=(0,c.$B)("/settings/users/:id"),{push:I}=(0,c.k6)(),{setUserDisplayName:K}=(0,a.useAppInfo)(),h=(0,a.useNotification)(),{lockApp:V,unlockApp:J}=(0,a.useOverlayBlocker)(),w=(0,Q.c)(ee.A,async()=>(await e.e(566).then(e.bind(e,20566))).MagicLinkEE);(0,a.useFocusWhenNavigate)();const{users:[Z],isLoading:le}=(0,j.R)({id:T},{cacheTime:0,onError(r){const{status:p}=r.response;p===403?(h({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),I("/")):h({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),ie=async(r,p)=>{V();try{const P=await se(T,$()(r,"confirmPassword"));h({type:"success",message:d({id:"notification.success.saved",defaultMessage:"Saved"})});const U=a.auth.getUserInfo();if(T.toString()===U.id.toString()){a.auth.setUserInfo(P);const S=z()(r,"username")||(0,E.Pp)(r.firstname,r.lastname);K(S)}p.setValues(L()(r,b))}catch(P){const U=(0,E.Iz)(P.response.data),S=Object.keys(U).reduce((F,D)=>(F[D]=U[D].id,F),{});p.setErrors(S),h({type:"warning",message:z()(P,"response.data.error.message","notification.error")})}J()},q=le||!w,de=q?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},x=Object.keys(L()(Z,b)).reduce((r,p)=>p==="roles"?(r[p]=(Z?.roles||[]).map(({id:P})=>P),r):(r[p]=Z?.[p],r),{}),ce=x.username||(0,E.Pp)(x.firstname,x.lastname),_=d(de,{name:ce});return q?t.createElement(i.o,{"aria-busy":"true"},t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(n.T,{primaryAction:t.createElement(m.z,{disabled:!0,startIcon:t.createElement(v.Z,null),type:"button",size:"L"},d({id:"global.save",defaultMessage:"Save"})),title:_,navigationAction:t.createElement(a.Link,{startIcon:t.createElement(R.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},d({id:"global.back",defaultMessage:"Back"}))}),t.createElement(g.D,null,t.createElement(a.LoadingIndicatorPage,null))):t.createElement(i.o,null,t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(B.Formik,{onSubmit:ie,initialValues:x,validateOnChange:!1,validationSchema:ae.YM},({errors:r,values:p,handleChange:P,isSubmitting:U,dirty:S})=>t.createElement(a.Form,null,t.createElement(n.T,{primaryAction:t.createElement(m.z,{disabled:U||!A?!0:!S,startIcon:t.createElement(v.Z,null),loading:U,type:"submit",size:"L"},d({id:"global.save",defaultMessage:"Save"})),title:_,navigationAction:t.createElement(a.Link,{startIcon:t.createElement(R.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},d({id:"global.back",defaultMessage:"Back"}))}),t.createElement(g.D,null,Z?.registrationToken&&t.createElement(s.x,{paddingBottom:6},t.createElement(w,{registrationToken:Z.registrationToken})),t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:7},t.createElement(s.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(M.Z,{variant:"delta",as:"h2"},d({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),t.createElement(y.r,{gap:5},ne.map(F=>F.map(D=>t.createElement(O.P,{key:D.name,...D.size},t.createElement(a.GenericInput,{...D,disabled:!A,error:r[D.name],onChange:P,value:p[D.name]||""}))))))),t.createElement(s.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(M.Z,{variant:"delta",as:"h2"},d({id:"global.roles",defaultMessage:"User's role"})),t.createElement(y.r,{gap:5},t.createElement(O.P,{col:6,xs:12},t.createElement(te.Z,{disabled:!A,error:r.roles,onChange:P,value:p.roles}))))))))))};k.propTypes={canUpdate:G().bool.isRequired};const oe=k,re=()=>{const A=(0,a.useNotification)(),d=(0,l.v9)(f._),T=t.useMemo(()=>({read:d.settings.users.read,update:d.settings.users.update}),[d.settings.users]),{isLoading:I,allowedActions:{canRead:K,canUpdate:h}}=(0,a.useRBAC)(T),{state:V}=(0,c.TH)(),J=V?.from??"/";return(0,t.useEffect)(()=>{I||!K&&!h&&A({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[I,K,h,A]),I?t.createElement(a.LoadingIndicatorPage,null):!K&&!h?t.createElement(c.l_,{to:J}):t.createElement(oe,{canUpdate:h})}},6324:(W,u,e)=>{e.d(u,{Z:()=>g});var t=e(27279),a=e(4987),l=e(57537),c=e(78031),f=e(70627),i=e.n(f),n=e(61020);const m=({children:s,target:o})=>{const M=(0,l.useNotification)(),{formatMessage:y}=(0,n.Z)(),{copy:O}=(0,l.useClipboard)(),v=y({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),R=async()=>{await O(o)&&M({type:"info",message:{id:"notification.link-copied"}})};return t.createElement(l.ContentBox,{endAction:t.createElement(a.h,{label:v,noBorder:!0,icon:t.createElement(c.Z,null),onClick:R}),title:o,titleEllipsis:!0,subtitle:s,icon:t.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};m.propTypes={children:i().oneOfType([i().element,i().string]).isRequired,target:i().string.isRequired};const g=m},30164:(W,u,e)=>{e.d(u,{A:()=>n});var t=e(27279),a=e(70627),l=e.n(a),c=e(61020),f=e(95651),i=e(6324);const n=({registrationToken:m})=>{const{formatMessage:g}=(0,c.Z)(),s=`${window.location.origin}${f.Z}auth/register?registrationToken=${m}`;return t.createElement(i.Z,{target:s},g({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};n.defaultProps={registrationToken:""},n.propTypes={registrationToken:l().string}},85243:(W,u,e)=>{e.d(u,{Z:()=>R});var t=e(27279),a=e(5627),l=e(78955),c=e(57537),f=e(34547),i=e(70627),n=e.n(i),m=e(61020),g=e(40464),s=e(72450);const o=(0,s.keyframes)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,M=s.default.div`
  animation: ${o} 2s infinite linear;
`,y=()=>t.createElement(M,null,t.createElement(f.Z,null)),O=async()=>{const{get:B}=(0,c.getFetchClient)(),{data:C}=await B("/admin/roles");return C.data},v=({disabled:B,error:C,onChange:z,value:N})=>{const{status:$,data:X}=(0,g.useQuery)(["roles"],O,{staleTime:5e4}),{formatMessage:L}=(0,m.Z)(),Y=C?L({id:C,defaultMessage:C}):"",G=L({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),H=L({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),j=L({id:"app.components.Select.placeholder",defaultMessage:"Select"}),Q=$==="loading"?t.createElement(y,null):void 0;return t.createElement(a.P,{id:"roles",disabled:B,error:Y,hint:H,label:G,name:"roles",onChange:E=>{z({target:{name:"roles",value:E}})},placeholder:j,multi:!0,startIcon:Q,value:N.map(E=>E.toString()),withTags:!0,required:!0},(X||[]).map(E=>t.createElement(l.W,{key:E.id,value:E.id.toString()},L({id:`global.${E.code}`,defaultMessage:E.name}))))};v.defaultProps={disabled:!1,error:void 0},v.propTypes={disabled:n().bool,error:n().string,onChange:n().func.isRequired,value:n().array.isRequired};const R=v},39394:(W,u,e)=>{e.d(u,{YM:()=>g,Rw:()=>f});var t=e(47853),a=e(57537);const l={firstname:t.Z_().trim().required(a.translatedErrors.required),lastname:t.Z_(),email:t.Z_().email(a.translatedErrors.email).lowercase().required(a.translatedErrors.required),username:t.Z_().nullable(),password:t.Z_().min(8,a.translatedErrors.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:t.Z_().min(8,a.translatedErrors.minLength).oneOf([t.iH("password"),null],"components.Input.error.password.noMatch").when("password",(s,o)=>s?o.required(a.translatedErrors.required):o)},f={...l,currentPassword:t.Z_().when(["password","confirmPassword"],(s,o,M)=>s||o?M.required(a.translatedErrors.required):M),preferedLanguage:t.Z_().nullable()},n={roles:t.IX().min(1,a.translatedErrors.required).required(a.translatedErrors.required)},g=t.Ry().shape({...l,isActive:t.Xg(),...n})}}]);
