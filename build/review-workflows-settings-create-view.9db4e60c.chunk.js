"use strict";(self.webpackChunkcmssample=self.webpackChunkcmssample||[]).push([[8936],{36318:(ve,I,t)=>{t.r(I),t.d(I,{default:()=>ne});var e=t(27279),c=t(57537),f=t(49402),Y=t(36364),Z=t(48102),y=t(10701),B=t(77970),R=t(21395),N=t(59082),E=t(71563),j=t(43433),H=t.n(j),J=t(61020),U=t(40464),$=t(51447),G=t(51754),K=t(92686),Q=t(79194),b=t(75021),g=t(11984),d=t(43390),m=t(38705),q=t(68997),_=t(85230),n=t(86978),ee=t(52258),te=t(3848),w=t(65649),se=t(66578);function oe(){const{formatMessage:o}=(0,J.Z)(),{post:ae}=(0,c.useFetchClient)(),{push:le}=(0,$.k6)(),{formatAPIError:re}=(0,c.useAPIErrorHandler)(),i=(0,f.I0)(),v=(0,c.useNotification)(),{collectionTypes:W,singleTypes:P,isLoading:k}=(0,K.G)(),{isLoading:h,meta:C,workflows:S}=(0,ee.n)(),{isLoading:L,roles:A}=(0,G.F)(void 0,{retry:!1}),p=(0,f.v9)(w.xU),ie=(0,f.v9)(w.bH),l=(0,f.v9)(w.DV),D=(0,f.v9)(w.g$),[F,u]=e.useState(!1),{isLoading:x,getFeature:ce}=(0,b.q)(),[fe,ge]=e.useState(null),[V,M]=e.useState({}),a=ce("review-workflows"),O=S.flatMap(s=>s.contentTypes),{mutateAsync:me,isLoading:ue}=(0,U.useMutation)(async({workflow:s})=>{const{data:{data:r}}=await ae("/admin/review-workflows/workflows",{data:s});return r},{onSuccess(){v({type:"success",message:{id:"Settings.review-workflows.create.page.notification.success",defaultMessage:"Workflow successfully created"}})}}),z=async()=>{M({});try{const s=await me({workflow:l});return le(`/settings/review-workflows/${s.id}`),s}catch(s){return s.response.data?.error?.name==="ValidationError"&&s.response.data?.error?.details?.errors?.length>0&&ge(s.response.data?.error?.details?.errors.reduce((r,X)=>(H()(r,X.path,X.message),r),{})),v({type:"warning",message:re(s)}),null}},de=async()=>{await z()},we=()=>{M({})},T=(0,E.useFormik)({enableReinitialize:!0,initialErrors:fe,initialValues:l,async onSubmit(){const s=l.contentTypes.some(r=>O.includes(r));a?.[n.Ef]&&C?.workflowCount>=parseInt(a[n.Ef],10)?u("workflow"):a?.[n._X]&&l.stages.length>=parseInt(a[n._X],10)?u("stage"):s?M(r=>({...r,hasReassignedContentTypes:!0})):z()},validate(s){return(0,se.V)({values:s,formatMessage:o})}});return(0,Q.v)(n.sN,te.I),e.useEffect(()=>{i((0,g.Js)()),h||i((0,g.PP)({workflows:S})),k||i((0,g.Pz)({collectionTypes:W,singleTypes:P})),L||i((0,g.Lk)(A)),i((0,g.wt)(k||L)),i((0,g.CI)({name:""}))},[W,i,k,L,h,A,P,S]),e.useEffect(()=>{!h&&!x&&(a?.[n.Ef]&&C?.workflowsTotal>=parseInt(a[n.Ef],10)?u("workflow"):a?.[n._X]&&l.stages.length>=parseInt(a[n._X],10)&&u("stage"))},[x,h,a,C?.workflowsTotal,l.stages.length]),e.useEffect(()=>{!p&&D.length===0&&v({blockTransition:!0,type:"warning",message:o({id:"Settings.review-workflows.stage.permissions.noPermissions.description",defaultMessage:"You don\u2019t have the permission to see roles"})})},[o,p,D,v]),e.createElement(e.Fragment,null,e.createElement(d.lx,null),e.createElement(E.FormikProvider,{value:T},e.createElement(E.Form,{onSubmit:T.handleSubmit},e.createElement(d.h4,{navigationAction:e.createElement(d.eJ,{href:"/settings/review-workflows"}),primaryAction:e.createElement(Z.z,{startIcon:e.createElement(N.Z,null),type:"submit",size:"M",disabled:!ie,isLoading:ue},o({id:"global.save",defaultMessage:"Save"})),title:o({id:"Settings.review-workflows.create.page.title",defaultMessage:"Create Review Workflow"}),subtitle:o({id:"Settings.review-workflows.page.subtitle",defaultMessage:"{count, plural, one {# stage} other {# stages}}"},{count:l?.stages?.length??0})}),e.createElement(d.fC,null,e.createElement(y.k,{alignItems:"stretch",direction:"column",gap:7},p?e.createElement(B.a,null,o({id:"Settings.review-workflows.page.isLoading",defaultMessage:"Workflow is loading"})):e.createElement(y.k,{alignItems:"stretch",direction:"column",gap:7},e.createElement(_.Y,null),e.createElement(q.U,{stages:T.values?.stages})))))),e.createElement(c.ConfirmDialog.Root,{isConfirmButtonLoading:p,isOpen:Object.keys(V).length>0,onToggleDialog:we,onConfirm:de},e.createElement(c.ConfirmDialog.Body,null,e.createElement(y.k,{direction:"column",gap:5},V.hasReassignedContentTypes&&e.createElement(R.Z,{textAlign:"center",variant:"omega"},o({id:"Settings.review-workflows.page.delete.confirm.contentType.body",defaultMessage:"{count} {count, plural, one {content-type} other {content-types}} {count, plural, one {is} other {are}} already mapped to {count, plural, one {another workflow} other {other workflows}}. If you save changes, {count, plural, one {this} other {these}} {count, plural, one {content-type} other {{count} content-types}} will no more be mapped to the {count, plural, one {another workflow} other {other workflows}} and all corresponding information will be removed."},{count:O.filter(s=>l.contentTypes.includes(s)).length})),e.createElement(R.Z,{textAlign:"center",variant:"omega"},o({id:"Settings.review-workflows.page.delete.confirm.confirm",defaultMessage:"Are you sure you want to save?"}))))),e.createElement(m.fC,{isOpen:F==="workflow",onClose:()=>u(!1)},e.createElement(m.Dx,null,o({id:"Settings.review-workflows.create.page.workflows.limit.title",defaultMessage:"You\u2019ve reached the limit of workflows in your plan"})),e.createElement(m.uT,null,o({id:"Settings.review-workflows.create.page.workflows.limit.body",defaultMessage:"Delete a workflow or contact Sales to enable more workflows."}))),e.createElement(m.fC,{isOpen:F==="stage",onClose:()=>u(!1)},e.createElement(m.Dx,null,o({id:"Settings.review-workflows.create.page.stages.limit.title",defaultMessage:"You have reached the limit of stages for this workflow in your plan"})),e.createElement(m.uT,null,o({id:"Settings.review-workflows.create.page.stages.limit.body",defaultMessage:"Try deleting some stages or contact Sales to enable more stages."}))))}function ne(){const o=(0,f.v9)(Y._);return e.createElement(c.CheckPagePermissions,{permissions:o.settings["review-workflows"].create},e.createElement(oe,null))}}}]);
